---
// src/components/Header.astro
const currentPath = Astro.url.pathname;
---

<header class="site-header">
  <div class="header-container">
    <a href="/" class="brand-logo">
      <img 
        src="/logo.webp" 
        alt="Logo Pizza" 
        class="logo-icon" 
        width="125" 
        height="125" 
      />
      <span class="brand-text">PIZZAS A TODO GAS</span>
    </a>

    <nav class="main-nav">
      <ul>
        <li>
          <a href="/" class={currentPath === "/" ? "active" : ""}>Inicio</a>
        </li>
        <li>
          <a href="/carta" class={currentPath === "/carta" ? "active" : ""}>Nuestra Carta</a>
        </li>
        <li><a href="/local">El Local</a></li>
        <li><a href="/contacto">Contacto</a></li>
      </ul>
    </nav>

    <div class="header-actions">
      
      <a href="tel:+34654843625" class="action-btn btn-call">
        <span class="icon-wrapper">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
        </span>
        <div class="btn-text">
          <span class="label">PIDE AHORA</span>
          <span class="number">654 84 36 25</span>
        </div>
      </a>

      <a href="https://www.google.com/maps/dir//41650+El+Saucejo,+Sevilla/@37.2645146,-5.5302346,15z/data=!4m8!4m7!1m0!1m5!1m1!1s0xd0d530f877bfbd1:0xfc2f1115f10a4f6!2m2!1d-5.0924655!2d37.0693307?entry=ttu&g_ep=EgoyMDI2MDEwNy4wIKXMDSoASAFQAw%3D%3D" target="_blank" rel="noopener noreferrer" class="action-btn btn-location">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
        <span class="location-text">VER MAPA</span>
      </a>
      
      <button class="icon-btn menu-grid-btn" aria-label="Abrir menú" id="mobile-menu-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
      </button>
    </div>
  </div>

  <div class="mobile-menu-overlay" id="mobile-menu">
    <nav class="mobile-nav-content">
      <ul class="mobile-links">
        <li><a href="/" class="mobile-link">Inicio</a></li>
        <li><a href="/carta" class="mobile-link">Nuestra Carta</a></li>
        <li><a href="/local" class="mobile-link">El Local</a></li>
        <li><a href="/contacto" class="mobile-link">Contacto</a></li>
      </ul>
      
      <div class="mobile-menu-footer">
        <p>Llámanos: <strong>654 84 36 25</strong></p>
      </div>
    </nav>
  </div>

</header>

<style>
  /* --- LAYOUT HEADER BASE --- */
  .site-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000;
    padding: 10px 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.4s ease;
  }

  .site-header.scrolled {
    background: rgba(10, 10, 10, 0.95);
    backdrop-filter: blur(10px);
    padding: 5px 0;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .header-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 96%;
    max-width: 1600px;
    margin: 0 auto;
    padding: 0 10px;
    /* Evita que los hijos se encimen si el ancho es muy pequeño */
    gap: 20px; 
  }

  /* --- BRAND --- */
  .brand-logo {
    display: flex;
    align-items: center;
    gap: 15px;
    text-decoration: none;
    /* CRÍTICO: Evita que el logo se aplaste */
    flex-shrink: 0; 
    z-index: 1002;
    position: relative;
  }

  .logo-icon {
    width: 125px;
    height: 125px;
    object-fit: contain;
    filter: drop-shadow(0 0 15px rgba(0,0,0,0.6));
    transition: transform 0.3s ease;
  }
  
  .brand-logo:hover .logo-icon {
    transform: rotate(-5deg) scale(1.05);
  }

  .brand-text {
    font-family: var(--font-heading);
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--color-text-main);
    letter-spacing: 1px;
    text-transform: uppercase;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
    /* CRÍTICO: El texto nunca debe saltar de línea */
    white-space: nowrap; 
  }

  /* --- NAV ESCRITORIO --- */
  .main-nav {
    /* Permitir encogerse si es necesario, pero preferimos ocultarlo via media query */
    flex-shrink: 1; 
  }

  .main-nav ul {
    display: flex;
    /* Gap dinámico: se reduce si la pantalla se achica */
    gap: clamp(20px, 3vw, 40px); 
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .main-nav a {
    font-family: var(--font-heading);
    font-size: 1.1rem;
    font-weight: 500;
    color: var(--color-stone-grey);
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 1px;
    position: relative;
    transition: color 0.3s ease;
    /* CRÍTICO: No permitir saltos de línea en los enlaces */
    white-space: nowrap;
  }

  .main-nav a:hover, 
  .main-nav a.active {
    color: var(--color-accent);
  }
  
  .main-nav a.active::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: var(--color-accent);
    box-shadow: 0 0 10px var(--color-accent);
  }

  /* --- ACTIONS & BUTTONS --- */
  .header-actions {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-shrink: 0; /* Los botones no deben desaparecer ni aplastarse */
    z-index: 1002;
    position: relative;
  }

  .action-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    font-family: var(--font-heading);
    text-transform: uppercase;
    cursor: pointer;
    white-space: nowrap; /* CRÍTICO */
  }

  .btn-call {
    background-color: var(--color-accent);
    color: #000;
    padding: 10px 24px;
    gap: 12px;
    clip-path: polygon(0 0, 100% 0, 100% 85%, 92% 100%, 0 100%);
    box-shadow: 0 4px 15px rgba(255, 193, 7, 0.3);
  }

  .btn-call:hover {
    background-color: var(--color-accent-hover);
    transform: translateY(-2px) scale(1.02);
    box-shadow: 0 6px 20px rgba(255, 193, 7, 0.5);
  }

  .btn-call .icon-wrapper {
    background: rgba(0,0,0,0.1);
    padding: 6px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .btn-call .btn-text {
    display: flex;
    flex-direction: column;
    line-height: 1;
    align-items: flex-start;
  }

  .btn-call .label {
    font-size: 0.75rem;
    font-weight: 700;
    opacity: 0.8;
    margin-bottom: 2px;
  }

  .btn-call .number {
    font-size: 1.2rem;
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .btn-location {
    background: transparent;
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: var(--color-text-main);
    padding: 12px 20px;
    gap: 10px;
    font-size: 0.95rem;
    font-weight: 600;
    letter-spacing: 1px;
    border-radius: 4px;
  }

  .btn-location:hover {
    border-color: var(--color-accent);
    color: var(--color-accent);
    background: rgba(0,0,0,0.3);
  }

  .menu-grid-btn {
    display: none;
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 5px;
  }

  /* --- MENU MOVIL OVERLAY --- */
  .mobile-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background-color: var(--color-bg);
    z-index: 1001;
    padding-top: 100px;
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.77, 0, 0.175, 1);
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }

  .mobile-menu-overlay.open {
    transform: translateX(0);
  }

  .mobile-nav-content {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 40px;
  }

  .mobile-links {
    list-style: none;
    padding: 0;
    margin: 0;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 25px;
  }

  .mobile-link {
    font-family: var(--font-heading);
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-text-main);
    text-transform: uppercase;
    text-decoration: none;
    letter-spacing: 1px;
  }

  .mobile-link:hover {
    color: var(--color-accent);
  }

  .mobile-menu-footer {
    color: var(--color-stone-grey);
    font-family: var(--font-body);
    margin-top: 20px;
  }
  .mobile-menu-footer strong {
    color: var(--color-accent);
  }

  /* --- GESTIÓN DE ESPACIO RESPONSIVE (CRÍTICO) --- */

  /* 1. Etapa: Laptop Mediano (Ocultar texto marca) */
  @media (max-width: 1450px) {
    .brand-text {
      display: none; /* Quitamos el texto grande del logo para dar aire al menú */
    }
    .logo-icon {
      /* Mantenemos el logo icon visible pero ajustamos tamaño si es necesario */
      width: 100px; 
      height: 100px;
    }
  }

  /* 2. Etapa: Laptop Pequeño (Ocultar botón mapa) */
  @media (max-width: 1200px) {
    .btn-location {
      display: none; /* Quitamos botón de mapa, dejamos solo Llamar */
    }
  }

  /* 3. Etapa: Tablet Horizontal / Híbrido (Cambio a Hamburguesa) */
  /* Aquí es donde normalmente se rompe todo. Activamos hamburguesa ANTES de que choque */
  @media (max-width: 1024px) {
    .main-nav { 
        display: none; /* Adiós menú texto */
    }
    .menu-grid-btn { 
        display: block; /* Hola hamburguesa */
    }
    /* En este punto solo tenemos: Logo Icon + Botón Llamar + Hamburguesa */
    .header-container {
        justify-content: space-between;
    }
  }

  /* 4. Etapa: Móvil Puro */
  @media (max-width: 768px) {
    .site-header { padding: 5px 0; }
    .header-container { padding: 0 15px; }
    
    .logo-icon {
        width: 70px;
        height: 70px;
    }

    .header-actions { gap: 10px; }

    /* Botón llamar compacto */
    .btn-call { padding: 8px 16px; }
    .btn-call .label { display: none; }
    .btn-call .number { font-size: 1rem; }
  }

  /* 5. Etapa: Móvil Mini (iPhone SE, Fold cerrado) */
  @media (max-width: 380px) {
    .btn-call .number { display: none; } /* Solo icono teléfono */
    .btn-call { padding: 10px; border-radius: 50%; clip-path: none; }
    .btn-call .icon-wrapper { background: none; padding: 0; }
  }
</style>

<script>
  const initHeader = () => {
    const header = document.querySelector('.site-header');
    const scrollThreshold = 20;
    
    if (header) {
      const handleScroll = () => {
        if (window.scrollY > scrollThreshold) {
          header.classList.add('scrolled');
        } else {
          header.classList.remove('scrolled');
        }
      };
      window.addEventListener('scroll', handleScroll);
      handleScroll();
    }

    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileLinks = document.querySelectorAll('.mobile-link');

    if (menuBtn && mobileMenu) {
      menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('open');
        document.body.style.overflow = mobileMenu.classList.contains('open') ? 'hidden' : '';
      });

      mobileLinks.forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.classList.remove('open');
          document.body.style.overflow = '';
        });
      });
    }
  };

  document.addEventListener('astro:page-load', initHeader);
</script>